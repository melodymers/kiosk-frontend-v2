<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ValACE User QR Scan</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', ui-sans-serif, system-ui, sans-serif; }
    .border-gradient { border-image: linear-gradient(to right, #3b82f6, #6366f1) 1; }
  </style>
</head>
<body class="min-h-screen w-full bg-gradient-to-br from-indigo-50 via-white to-blue-50 flex flex-col">
  <!-- Header -->
  <header class="bg-white/80 backdrop-blur-md shadow-xl border-b border-gray-100 py-6 px-6">
    <div class="container mx-auto flex items-center justify-between">
      <button onclick="navigateBack()" class="flex items-center gap-2 text-gray-700 hover:text-gray-900 transition-all duration-200">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>
        <span class="text-lg font-semibold">Back</span>
      </button>
      <div class="w-20 h-12 flex-shrink-0">
        <img src="./logo.png" alt="ValACE Logo" class="w-full h-full object-contain">
      </div>
    </div>
  </header>

  <main class="flex-1 container mx-auto px-6 py-12 flex flex-col items-center justify-center gap-8">
    <!-- Search Bar Section -->
    <div class="w-full max-w-2xl opacity-0 translate-y-5 animate-[fade-in-up_0.5s_ease-out_0.2s_forwards]">
      <div class="relative bg-white rounded-2xl shadow-xl p-6 border border-gray-100">
        <div class="flex gap-3">
          <div class="flex-1 relative">
            <svg class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
            <input
              type="text"
              id="passIdInput"
              placeholder="Type your ValACE Pass ID..."
              class="w-full pl-12 pr-4 py-4 bg-gray-50 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:bg-white focus:outline-none transition-all duration-200 text-lg placeholder-gray-500"
              onkeypress="handleKeyPress(event)"
            />
          </div>
          <button onclick="handleSearch()" class="px-8 py-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl font-semibold text-lg shadow-lg hover:from-blue-700 hover:to-indigo-700 transition-all duration-200 whitespace-nowrap active:scale-95">
            Search
          </button>
        </div>
      </div>
    </div>

    <!-- QR Scanner Card -->
    <div class="bg-white/70 backdrop-blur-md rounded-3xl shadow-2xl p-8 max-w-2xl w-full border border-white/50 opacity-0 scale-90 animate-[fade-in-up_0.5s_ease-out_0.4s_forwards]">
      <div class="text-center mb-8">
        <div class="inline-block mb-6 p-4 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-2xl shadow-lg animate-[bounce_2s_infinite]">
          <svg class="w-20 h-20 text-white mx-auto drop-shadow-md" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"></path>
          </svg>
        </div>
        <h2 class="text-4xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 bg-clip-text text-transparent mb-3">
          Scan Your QR Code
        </h2>
        <p class="text-xl text-gray-600 font-medium">
          Position your QR code within the frame below
        </p>
      </div>

      <div class="relative mx-auto max-w-xs">
        <div id="qr-reader" class="rounded-2xl overflow-hidden border-4 border-gradient shadow-2xl mx-auto"></div>
        <div id="scanOverlay" class="absolute inset-0 pointer-events-none flex items-center justify-center opacity-0">
          <div class="w-72 h-72 border-4 border-blue-400 rounded-2xl bg-blue-400/10 animate-[pulse_2s_infinite]"></div>
        </div>
      </div>

      <!-- Success Message -->
      <div id="successMsg" class="mt-8 p-6 bg-gradient-to-r from-green-100 to-emerald-100 border-4 border-green-400 rounded-2xl text-center shadow-xl opacity-0 translate-y-5 scale-90">
        <div class="w-16 h-16 bg-green-500 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg">
          <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"></path>
          </svg>
        </div>
        <p class="text-green-800 font-bold text-xl mb-2">QR Code Scanned Successfully!</p>
        <p class="text-green-700 text-lg font-medium">Redirecting to review...</p>
      </div>
    </div>


  <script>
    let scanner = null;
    let isScanning = false;
    let scanResult = '';

    // Navigate functions (replace with your routing logic)
    function navigateBack() {
      window.history.back();
    }

    function skipToReview() {
      window.location.href = 'review.html';
    }

    // Search functionality
    function handleSearch() {
      const passId = document.getElementById('passIdInput').value.trim();
      if (passId) {
        showSuccess();
        setTimeout(() => {
          window.location.href = 'review.html';
        }, 1500);
      }
    }

    function handleKeyPress(event) {
      if (event.key === 'Enter') {
        handleSearch();
      }
    }

    // QR Scanner
    async function startScanner() {
      try {
        scanner = new Html5Qrcode('qr-reader');
        await scanner.start(
          { facingMode: 'environment' },
          {
            fps: 10,
            qrbox: { width: 300, height: 300 }
          },
          (decodedText) => {
            scanResult = decodedText;
            scanner.stop();
            showSuccess();
            setTimeout(() => {
              window.location.href = 'review.html';
            }, 1500);
          },
          () => {}
        );
        isScanning = true;
        document.getElementById('scanOverlay').style.opacity = '1';
      } catch (err) {
        console.error('Error starting scanner:', err);
      }
    }

    function showSuccess() {
      const successMsg = document.getElementById('successMsg');
      successMsg.style.opacity = '1';
      successMsg.style.transform = 'translateY(0) scale(1)';
    }

    // Initialize scanner on load
    window.addEventListener('load', () => {
      startScanner();
    });

    // Cleanup on unload
    window.addEventListener('beforeunload', () => {
      if (scanner && isScanning) {
        scanner.stop().catch(console.error);
      }
    });
  </script>

  <!-- Keyframe animations -->
  <style>
    @keyframes fade-in-up {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .animate-[fade-in-up_0.5s_ease-out_0.2s_forwards] {
      animation: fade-in-up 0.5s ease-out 0.2s forwards;
    }
    .animate-[fade-in-up_0.5s_ease-out_0.4s_forwards] {
      animation: fade-in-up 0.5s ease-out 0.4s forwards;
    }
    .animate-[fade-in-up_0.5s_ease-out_0.7s_forwards] {
      animation: fade-in-up 0.5s ease-out 0.7s forwards;
    }
    .animate-[bounce_2s_infinite] {
      animation: bounce 2s infinite;
    }
    .animate-[pulse_2s_infinite] {
      animation: pulse 2s infinite;
    }
  </style>
</body>
</html>
